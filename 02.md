# Eduard Titkov WorkArea 

## Видео №2. Asterisk и IP-телефония. 

## Знакомство с CentOS Linux 

## Видео №3. Удивительные особенности IP-телефонии 

## Видео №4. Варианты Использования IP-АТС Asterisk.

## Видео №5. Бизнес-Задачи, Решаемые При Помощи Asterisk.


### Asterisk - это открытое решение.

Asterisk - это открытое решение. 

**Ключевые преимущества Астериска:**

Единый номерной план
Единный кол-центр

Из закрытых решений популярны: Cisco, Avaya, Oktel, 

Asterisk - это открытое решение, лицензированное по лицензии GPL

Нельзя: закрывать код. 

Можно: форки, сообщества, свои продукты на основе. (+ коммерц) [наследование GPL лицензии]

Среди продуктов: Помимо Asterisk, например, в природе существует и его родитель FreeSwitch. 

Софтсвич - это программная атс. 

Софтсвичи 4-го уровня больше предназначены для операторов связи. Юзают FreeSwitch (главная задача этого уровня [операторского] - быстродействие), ключевая цель - транзит звонков, биллинг. Можно юзать и Asterisk, но нецелесообразно.

Софтсвич 5-го уровня - это классическая офисная ip-атс. Наиболее популярное решение этого уровня - это Asterisk(главная задача этого уровня - пользовательский функционал).

**Примерный функционал пятого уровня:**
* Связь между абонентами
* Звонки в город / из города
* Интерактивное голосовое меню
* Перевод / перехват вызова
* Запись разговоров
* Ограничение доступа пользователей
* Конференц-связь
* Очереди звонком
* DISA, Callback
... и множество других



Asterisk - это программный коммутатор звонков. С одной стороны к Asterisk-серверу  подключаются операторы тел.связи и иные АТС, а с другой - внутренние абоненты. Asterisk выполняет маршрутизацию этой связи <абоненты-оператор>

между абонентом и оператором - исходящие звонки.
между оператором и абонентом - входящие.

Asterisk называют звёздочкой. << * >> Подразумевая систему, способную решать любые задачи.

Первая альфа-версия продукта 0.1 появилась в 1999 году
Релиз версия 1.0 - в 2004

Разработчик Марк Спенсер. [Автор GTK+, Pidgin, L2TP]

Существуют LTS-версии. (5 лет)

Всё управление Asterisk'ом происходит из консоли, конфигов --> это linux-софт.

Для упрощения разработаны веб-морды.





### Примерное Оборудование, в схемах, когда к Астериску нужно подключить аналоговых/цифровых абонентов [не ip, тоесть] .

Digium AEX800P - карта pci-e с портами для подключения аналоговых линий. 

Digium te121 - карта на порт e1 [e1 - это цифровой поток]

### Облачная телефония vs Asterisk

Клиенты часто выбирая между Астериском и облачной телефонией, считают что облачная телефония окажется сильно дешевле, однако при использовании облачной телефонии приходится отказываться от существующих в инфраструктуре операторов связи и терять номера, приходится выкидывать свои аналоговые телефоны. Либо, что ещё страшнее, приходится разбивать существующую инфраструктуру, все аналоговые медные втыкать если не в астериск то в какой-нибудь панасоник, а облачная телефония - это ip-телефоны и только. На выходе имеем не связанные с собой части целого.

### Наиболее частые схемы использования Asterisk

#### Традиционная атс  (или аналоговая, или чисто воип, или сервер с гибридными каналами связи).

#### Колл-центр [обработка вызова, переключение на свободного оператора, звонок в очередь на ожидание - очереди могут быть различны т.к. различны операторы]

> При проектировании системы нужно учитывать, что нагрузка на сервер будет различной в зависимости от выбранного архитектурного решения. Колцентр - это ресурсоемкое решение.

В коллцентрах отведена роль супервайзера, который следит за тем, чтобы предоставлялся сервис, следит за операторами, может вести управленческую деятельность, etc. В качестве инструментов ему необходима. например,  панель мониторинга, на которую может выводится статистика, аналитика, очереди, ключевые показатели, загруженность операторов  etc Ему необходимы инструменты для live прослушивания разговоров, для прослушивания сохраненны записей разговорв. Вплоть до того, что возможны инструменты, когда супервайзер подключается в текущий разговор оператор-клиент и для клиента это неочевидно, в то время как оператор может консультироваться/получать подсказки/слышать супервайзера.

Ещё по колцентру: входящий звонок на компьютер оператора может инициировать определенный программный код на компьютере оператора. Например, если налажена связь с 1с, при звонке с номера можно подгружать выгрузку, формирую карточку клиента и показывая его баланс, данные, прошлые обращения, etc -- это прикольно.

т.е. это о контексте.

и не только: тем самым мы разгружаем оператора и даём ему больше человеческого времени, механику беря на себя.

? - кто такой оператор связи?
> Оператор связи — юридическое лицо или индивидуальный предприниматель, оказывающие услуги связи на основании соответствующей лицензии. 

? - кто есть voip-оператор?
> Известные VoIP-провайдеры России и мира
В заключение назовем некоторых известных провайдеров VoIP телефонии, работающих в России и в мире. В нашей стране это: SIPNET, TelMe, PCTel, Telefonu.net, Pc-To-Phone.ru, Gizmo Project, Wengo, BetaMax, Global Telecom.

В мире: Anveo (США), Callcentric (США), CallWithUs (США), Modulis.ca (Канада), MyOwn Telco (Канада), Nextiva (США), sipgate (Германия), SIPRoutes (Англия), SIPSaver (Канада), Speedflow Communications (Англия), Voiceflex (Англия), Voip.ms (Канада), Vezatel (Канада).

--


Засчёт того что суфлер подсказывает оператору, оператора можно быстрее научить, ввести его в курс дела.

 Вся информация о качестве работы операторов, о качестве работы очередей долдна накапливапться и должна отображаться супервайзеру, чтобы орен знал что его коллцентр работает согласно требованиям. 

Если эта информация не накапливается, супервайзер не знает какие проблемы есть в колл центре и засчет чего они происходят

Очереди - это воронки. Клиенты падают в эту воронку и выстраиваются в этой трубе. Если звонков больше чем операторов - выстраивается очередь.
![img](https://i.imgur.com/VRqHzCY.png)

Оператор может одновременно находится в нескольких очередях.

 Колл - центр - это одно из удачных применений астериска, очень популярное решение.

#### транзитный сервер (шлюз)

? использование Asterisk в качестве транзитного сервера - это логика уровня 4?

https://youtu.be/af4vVaMcx-0?t=2009

Видимо нет. Идея в том, что если есть какая-то уже существующая рабочая инфраструктура (завязанная на медь), и всё работает - но хочется большего функционала. И чтобы не переставлять всё на новые рельсы - поскольку избавляться от меди больно $$ (ТАК. А зачем от неё избавляться?)- внедряется Asterisk. - я не уловил логику, а зачем от неё избавляться.

Ответ тут в том, что нужно будет покупать платы, а это дорого. В качестве транзитного сервера в этой схеме платы астериску не нужны, а транзит и шлюз будет исполнен посредством sip-транка.


а до этого на чём оно работало (на уровне 5 же работало?) и в чём сложность. Зачем заменять аналоговые телефоны на ip, и тем более зачем добавлять лишнюю сложность в виде транзитного сервера? Это же даже не костыль, получается?


--


 Идея в том, что мы не трогаем инфраструктуру это говно клиента, а просто внедряем выше по уровню свой сервер, укомплектовываем его там платами нужными и в нужном количестве,и пропускаем весь траф через себя. 
 
 И засчёт такого включения - реализовывается недостающий фнукционал, например, панасоника.
 
 Астериском мы можем разговор записать, прослушать, запретить.

Например, мы видим что абонент, которому нельзя звонить по межгороду - звонит по межгороду. -- это можно блокировать.
 
 Но больше того, мы можем станцию развивать. - Подключать новых абонентов как ip-телефоны, подключенные к астериску. И таким образом вызов будет идти по sip, затем по e1, а затем и вовсе по аналогу. o_O
 ![Imgur](https://i.imgur.com/4uK85Li.png) -- и это совершенно нормальная схема.
 
 А ещё мы можем подключить к Астериску по сип-протоколу воип-провайдеру, и можно будет звонить вот так через него дешевле.
 
 т.е может быть так, и так зачастую и есть, что стоимость звонков у текущего оператора связи много больше чем у операторов связи voip. Тарифы могут быть сильно выше чем у сипового оператора связи.
 
 ![Imgur](https://i.imgur.com/pX5UBJO.png)












#### Вариант, когда Астериск устанавливается (на виртулку или на голое железо), а затем по локальной сети астериск подключается в свитч.
И к нему уже подключаются софтфоны[програмные телефоны], ип-телефоны, etc.

![Imgur](https://i.imgur.com/OLxkFg2.png)

По протоколу SIP, или скайп, или H.323 к нему подключаются voip - провайдеры. -- соединение может бытбь масса .

И в тоже время к Астериску могут быть через интернет подключены удаленные абоненты. Это могут быть офисы каких-то компаний. Это может быть подключен другой астериск, работающий по протоколу iax2 и за собой имеющий тоже множество абонентов.


#### В схеме *гибридного сервера* один из операторов связи работает по меди. А схема сама по себе отображает все возможные варианты подключений.

![Imgur](https://i.imgur.com/SImnVyq.png)

Эта схема популярна потому, что зачастую это является модернизацией старых инфрастуктур. Астериск встаёт на место какого-нить панасоника. Панасоник заменяют, но на своих местах остаются аналоговые/цифровые линии, аналоговые абоненты. Чтобы от всего этого не избавляться, не отказываться от старых номеров -- и вместе с тем добавить требуемый функционал -- ставится Астериск, докомплектовывается платами, и получается что к Астериску можно подключить те линии, которые раньше входили в панасоник (те линии, которые входили от аналоговывх телефонов ), в то же время подключить какие-то новые уже ип-телефоны, подключить виртуальные офисы, подключить сип-провайдеров, звонить по междугородной связи по номерам 810..
![Imgur](https://i.imgur.com/IuB4snI.png)
по данной схеме мы не стали отказываться целиком от того, что было до Астериска, - сохраняли инфраструктуру, и в тоже время расширили её, расширили функционал телефонии очень значительно




#### Схема, когда Asterisk стоит в стороне - сервер приложений. Для того чтобы попасть на него есть определённый путь, который и используется, при надобности.

#### Схема. когда Asterisk используется в качестве VoIP-провайдера

Это уже четвертый уровень, и это уже другой класс знания.








--




# Личные заметки. это мне было интересно для самого себя дополнительно прояснить


![Imgur](https://voxlink.ru/wp-content/themes/voxlink/minimg/shemy/shv4.jpg)


## Аналоговые, цифровые и гибридные атс:
https://www.multicom.ru/ats-likbez/analogovye-tsifrovye-i-gibridnye-ats/

## Аналаговые АТС. FXO(АНАЛОГОВЫЕ ЛИНИИ)

**АТС (FXO) <-> FXS (Asterisk)**
В такой схеме Астериск для АТС 
- это как городская станция. При наборе номера в такую линию, АТС ее "подымает", и набирает тоновым или пульсовым набором номер, который "виден" на Asterisk. Это позволяет прозрачно объединить номерные планы АТС и Asterisk. Так как даже по одной линии можно маршрутизировать много разных номеров.

**АТС (FXS) <-> FXO (Asterisk)**
Однако, в старых АТС обычно внешних линий мало и они все заняты, чтобы реализовать описанную выше схему. Вместо этого часть абонентов старой АТС от нее отключаются, и переводятся на SIP телефоны через Asterisk, тем самым высвобождая свободные внутренние линии. Однако, в такой схеме Asterisk для АТС 
- это набор телефонных аппаратов. Станция не посылает на Asterisk набранный номер, она может послать только индикацию вызова. В Астериск такие звонки приходят на s exten, и он не види


## Цифровой поток ISDNPRI (E1)

> **Цифровой поток ISDNPRI (Е1)**

**Отличие цифровой АТС от аналоговой** заключается в том, что цифровая АТС предусматривает работу с так называемыми цифровыми телефонными аппаратами.

Практически во всех цифровых АТС отдается преимущество подключению к телефонной сети общего пользования (ТФОП) по цифровому каналу – Е1 ISDNPRI.

Для совместимости со старыми аналоговыми городскими телефонными станциями производители АТС выпускают платы для подключения к городским аналоговым (обычным «медным») телефонным линиям. В настоящее время не целесообразно и очень дорого комплектовать станцию огромным числом плат по 8 аналоговых портов, занимающих к тому же слоты расширения в станции.


ISDN (англ. Integrated Services Digital Network) — данная технология обеспечивает передачу цифрового сигнала по телефонным каналам с предоставлением различных служб.

Основное назначение ISDN — передача данных со скоростью до 64 кбит/с по абонентской проводной линии и обеспечение интегрированных телекоммуникационных услуг (телефон, факс и пр.). Использование для этой цели телефонных проводов имеет два преимущества: они уже существуют и могут использоваться для подачи питания на терминальное оборудование.

Услуги ISDN могут предоставляться двумя способами, по интерфейсу PRI - "Интерфейса первичной скорости" и BRI - "Интерфейс базовой скорости".

PRI - это стандарт, используемый для подключения офисов. Он использует для передачи информации канал T1 в США, и **канал E1** для Европы. Канал T1 PRI содержит в себе 24 канала, E1 PRI - 32 канала.




## IP-телефония [PBX] [С появлением интернета.]

С появлением интернета человек получил не только среду для доступа к информации, но и новое средство общения, IP-телефонию. Основной принцип такого способа связи заключается в кодировании голоса в цифровой формат и в пересылке в таком виде на устройство другого абонента (компьютер, SIP-телефон). Далее сигнал декодируется из цифрового формата в аналоговый.

?? сигнал декодируется ___не всегда___ же?

Существует несколько систем корпоративной IP-телефонии. Одной из самых популярных является IP-PBX, то есть Private Branch eXchange. Основным каналом передачи сигнала в IP-PBX является VoIP. 


### PBX телефония, Протоколы PBX-телефонии [H.323 и SIP]

В PBX-телефонии используются два основных протокола: H.323 и SIP. Первый долгое время был лидером, но сегодня большей популярностью пользуется SIP. Его поддержали основные производители, в том числе Cisco и Polycom.

Протокол H.323 внедрил ITU-T — Международный союз электросвязи. IP в данном протоколе может не использоваться. Однако большинство реализаций основываются именно на нем.

Протоколом SIP (расшифровка аббревиатуры Session Initiation Protocol) описывается, как будет проходить сеанс интернет-связи, в входе которого предусматривается обмен мультимедиа. Он широко применяется для обмена мгновенными сообщениями, в компьютерных играх, аудио- и видеоконференциях.

Оба имеют прямое отношение к VoIP. Но в современных реалиях второй все больше заменяется первым.

Функционирование H.323 основано на битовых паролях. Если бы условия передачи данных были идеальными, эта особенность помогла бы сэкономить трафик. Однако теперь такая выгода нивелируется повсеместным распространением быстрого интернета.

Характеристики SIP-протокола делают его абсолютным лидером в «гонке» с H.323. Сети на основе этого протокола легко масштабируются: системный администратор может легко изменить число абонентов.

SIP полностью независим от транспортного уровня: он совместим с ATM, TCP, UDP и многими другими.

Каждый пользователь сети в рамках этого протокола получает уникальный идентификатор, поэтому может свободно перемещаться безо всяких ограничений.

SIP — это протокол, который имеет важно свойство расширяемости. Другими словами, когда будут появляться новые услуги, SIP может быть легко дополнен этими функциями.

В SIP заложена функция интеграции и взаимодействия с другими протоколами. SIP — это более гибкий протокол, чем H.323. На все существующие решения H.323 найдутся решения SIP. Таким образом, можно сделать вывод, что применение SIP является более выгодным, чем H.323.


* ... модуль, разработанный на основе известного решения Asterisk. Он поддерживает два протокола: IAX2 и SIP, а также способ шифрования SIP over TLS и SRTP...

SIP является протоколом сигнализации, он ответственен за установление сеанса между абонентами, при этом SIP выполняет функции протоколов Q.931, RAS и Н.245 стандарта Н.323 (точнее — часть из них). Для передачи аудио- и видеоданных в ходе сеанса протокол SIP предполагает использование протокола RTP.

Протокол SIP очень близок по стилю к протоколу HTTP: он имеет похожий набор и синтаксис сообщений, которыми обмениваются стороны в процессе установления сеанса. Как и у протокола HTTP, SIP-сообщения текстовые, они хорошо понятны программистам, имеющим опыт создания веб-приложений.




## RANDOM интересный

 ### sip-trunk

### Архитектура сети SIP, протокол установления сеанса:

https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB_%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F_%D1%81%D0%B5%D0%B0%D0%BD%D1%81%D0%B0#%D0%90%D1%80%D1%85%D0%B8%D1%82%D0%B5%D0%BA%D1%82%D1%83%D1%80%D0%B0_%D1%81%D0%B5%D1%82%D0%B8


### ПРОТОКОЛ IAX2 — Inter-Asterisk eXchange protocol — протокол обмена VoIP данными между IP-АТС Asterisk и другим аналогичным софтсвичом или VoIP-телефоном. 




















